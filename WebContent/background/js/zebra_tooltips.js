(function(g){g.Zebra_Tooltips=function(k,p){var q={animation_speed:250,animation_offset:20,background_color:"#000",close_on_click:!0,color:"#FFF",content:!1,hide_delay:100,keep_visible:!0,max_width:250,opacity:".95",position:"center",prerender:!1,show_delay:100,vertical_offset:0,onBeforeHide:null,onHide:null,onBeforeShow:null,onShow:null},d=this,l,h,t;d.settings={};d.hide=function(b,a){var c=b.data("Zebra_Tooltip");c&&(c.sticky=!1,a&&(c.destroy=!0),b.data("Zebra_Tooltip",c),m(b))};d.show=function(b, a){var c=b.data("Zebra_Tooltip");c&&(c.sticky=!0,c.muted=!1,a&&(c.destroy=!0),b.data("Zebra_Tooltip",c),r(b))};var n=function(b){var a=b.data("Zebra_Tooltip");if(!a.tooltip){var c=jQuery("<div>",{"class":"Zebra_Tooltip",css:{opacity:0,display:"block"}}),f=jQuery("<div>",{"class":"Zebra_Tooltip_Message",css:{"max-width":d.settings.max_width,"background-color":d.settings.background_color,color:d.settings.color}}).html(d.settings.content?d.settings.content:a.content).appendTo(c),a=jQuery("<div>",{"class":"Zebra_Tooltip_Arrow"}).appendTo(c), s=jQuery("<div>").appendTo(a);d.settings.keep_visible&&(c.bind("mouseleave"+(d.settings.close_on_click?" click":""),function(){m(b)}),c.bind("mouseenter",function(){r(b)}));c.appendTo("body");var k=c.outerWidth(),n=c.outerHeight(),p=s.outerWidth(),u=s.outerHeight(),e=f.outerWidth(),q=f.outerHeight(),a={tooltip:c,tooltip_width:k,tooltip_height:n+u/2,message:f,arrow_container:a,arrow_width:p,arrow_height:u,arrow:s};c.css({width:a.tooltip_width,height:a.tooltip_height});a.tooltip_width+=f.outerWidth()- e;a.tooltip_height+=f.outerHeight()-q;c.css({width:a.tooltip_width,height:a.tooltip_height,display:"none"});a=g.extend(b.data("Zebra_Tooltip"),a);b.data("Zebra_Tooltip",a)}a.sticky&&!a.close&&(jQuery("<a>",{"class":"Zebra_Tooltip_Close",href:"javascript:void(0)"}).html("x").bind("click",function(a){a.preventDefault();a=b.data("Zebra_Tooltip");a.sticky=!1;b.data("Zebra_Tooltip",a);m(b)}).appendTo(a.message),a.close=!0,a=g.extend(b.data("Zebra_Tooltip"),a),b.data("Zebra_Tooltip",a));if(a.window_resized|| a.window_scrolled)c=g(window),a.window_resized&&(l=c.width(),c.height(),f=b.offset(),g.extend(a,{element_left:f.left,element_top:f.top,element_width:b.outerWidth(),element_height:b.outerHeight()})),t=c.scrollTop(),h=c.scrollLeft(),c="left"==d.settings.position?a.element_left-a.tooltip_width+a.arrow_width:"right"==d.settings.position?a.element_left+a.element_width-a.arrow_width:a.element_left+(a.element_width-a.tooltip_width)/2,f=a.element_top-a.tooltip_height,e="left"==d.settings.position?a.tooltip_width- a.arrow_width-a.arrow_width/2:"right"==d.settings.position?a.arrow_width/2:(a.tooltip_width-a.arrow_width)/2,c+a.tooltip_width>l+h&&(e-=l+h-(c+a.tooltip_width)-6,c=l+h-a.tooltip_width-6,e+a.arrow_width>a.tooltip_width-6&&(e=a.tooltip_width-6-a.arrow_width),c+e+a.arrow_width/2<a.element_left&&(e=-1E4)),c<h&&(e-=h-c,c=h+2,0>e&&(e=a.arrow_width/2),c+e+a.arrow_width/2>a.element_left+a.element_width&&(e=-1E4)),a.arrow_container.removeClass("Zebra_Tooltip_Arrow_Top"),a.arrow_container.addClass("Zebra_Tooltip_Arrow_Bottom"), a.message.css("margin-top",""),a.arrow.css("borderColor",d.settings.background_color+" transparent transparent"),f<t?(f=a.element_top+a.element_height-d.settings.vertical_offset,a.animation_offset=Math.abs(a.animation_offset),a.message.css("margin-top",a.arrow_height/2),a.arrow_container.removeClass("Zebra_Tooltip_Arrow_Bottom"),a.arrow_container.addClass("Zebra_Tooltip_Arrow_Top"),a.arrow.css("borderColor","transparent transparent "+d.settings.background_color)):(a.animation_offset=-Math.abs(a.animation_offset), f+=d.settings.vertical_offset),a.arrow_container.css("left",e),a.tooltip.css({left:c,top:f}),g.extend(a,{tooltip_left:c,tooltip_top:f,arrow_left:e}),a.window_resized=!1,a.window_scrolled=!1,a=g.extend(b.data("Zebra_Tooltip"),a),b.data("Zebra_Tooltip",a);return a},m=function(b){var a=b.data("Zebra_Tooltip");clearTimeout(a.hide_timeout);a.sticky||(clearTimeout(a.show_timeout),a.hide_timeout=setTimeout(function(){if(a.tooltip){if(d.settings.onBeforeHide&&"function"==typeof d.settings.onBeforeHide)d.settings.onBeforeHide(b, a.tooltip);a.close=!1;a.destroy&&(a.muted=!0);b.data("Zebra_Tooltip",a);g("a.Zebra_Tooltip_Close",a.tooltip).remove();a.tooltip.stop();a.tooltip.animate({opacity:0,top:a.tooltip_top+a.animation_offset},d.settings.animation_speed,function(){g(this).css("display","none");if(d.settings.onHide&&"function"==typeof d.settings.onHide)d.settings.onHide(b,a.tooltip)})}},d.settings.hide_delay))},r=function(b){var a=b.data("Zebra_Tooltip");clearTimeout(a.show_timeout);a.muted||(clearTimeout(a.hide_timeout), a.show_timeout=setTimeout(function(){a=n(b);if(d.settings.onBeforeShow&&"function"==typeof d.settings.onBeforeShow)d.settings.onBeforeShow(b,a.tooltip);"block"!=a.tooltip.css("display")&&a.tooltip.css({top:a.tooltip_top+a.animation_offset});a.tooltip.css("display","block");a.tooltip.stop();a.tooltip.animate({top:a.tooltip_top,opacity:d.settings.opacity},d.settings.animation_speed,function(){if(d.settings.onShow&&"function"==typeof d.settings.onShow)d.settings.onShow(b,a.tooltip)})},d.settings.show_delay))}; (function(){d.settings=g.extend({},q,p);k.each(function(){var b=g(this),a=b.attr("title"),c=b.data("zebra-tooltip");if(a&&""!==a||c&&""!==c)b.bind({mouseenter:function(){r(b)},mouseleave:function(){m(b)}}),b.data("Zebra_Tooltip",{tooltip:null,content:c||a||"",window_resized:!0,window_scrolled:!0,show_timeout:null,hide_timeout:null,animation_offset:d.settings.animation_offset,sticky:!1,destroy:!1,muted:!1}),b.attr("title",""),d.settings.prerender&&n(b)});g(window).bind("scroll resize",function(b){k.each(function(){var a= g(this).data("Zebra_Tooltip");a&&("scroll"==b.type?a.window_scrolled=!0:a.window_resized=!0,g(this).data("Zebra_Tooltip",a))})})})()}})(jQuery);